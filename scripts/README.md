# Scripts Directory

This directory contains utility scripts for database management, seeding, and maintenance.

## Available Scripts

### seed_data.py

Seeds the database with sample data for development and testing.

**Purpose:**
- Populate database with realistic test data
- Create sample users with different permission levels
- Generate posts, comments, likes, and tags
- Create point transaction history
- Set up channels and point economy configuration

**Sample Data Created:**
- 10 users (Admin, Moderators, Regular Users with various levels)
- 5 channels (General, Announcements, Development, Crypto, Community)
- 10 tags (Help Wanted, Tutorial, Discussion, etc.)
- 5+ posts with nested comments
- 50+ comments (including nested replies)
- Random likes on posts
- Point transaction history for all users
- Point economy configuration

**Usage:**

```bash
# Activate virtual environment
source .venv/bin/activate

# Set required environment variables
export APP_SECRET_KEY='your-secret-key'
export SECURITY_JWT_SECRET_KEY='your-jwt-secret'
export IPFS_API_KEY='your-ipfs-key'

# Run seed script
python scripts/seed_data.py
```

**Sample Accounts:**

| Email | Username | Password | Level | Points |
|-------|----------|----------|-------|--------|
| admin@forum.com | admin | Admin123! | Admin | 50,000 |
| moderator@forum.com | mod_alice | Moderator123! | Moderator | 5,000 |
| bob@example.com | bob_dev | User123! | Trusted User | 1,200 |
| carol@example.com | carol_crypto | User123! | Active User | 300 |
| dave@example.com | dave_newbie | User123! | New User | 50 |

**Note:** This script should only be run in development environments. Do not run on production databases.

## Database Migrations

### Setup

Alembic is configured for database migrations with async SQLAlchemy 2.0 support.

**Configuration Files:**
- `alembic.ini` - Alembic configuration
- `alembic/env.py` - Migration environment setup (async-compatible)
- `alembic/versions/` - Migration scripts

### Creating Migrations

```bash
# Create a new migration (manual)
alembic revision -m "description_of_changes"

# Create an autogenerated migration (requires psycopg2)
alembic revision --autogenerate -m "description_of_changes"
```

### Running Migrations

```bash
# Upgrade to latest version
alembic upgrade head

# Upgrade one version
alembic upgrade +1

# Downgrade one version
alembic downgrade -1

# Show current version
alembic current

# Show migration history
alembic history
```

### Migration File Naming

Migrations use timestamped naming: `YYYYMMDD_HHMM-{revision}_{description}.py`

Example: `20251024_1807-2963c4558295_initial_schema.py`

## Environment Variables Required

All scripts require these environment variables:

```bash
# Application
APP_SECRET_KEY=<32+ character secret key>

# Security
SECURITY_JWT_SECRET_KEY=<32+ character JWT secret>

# IPFS
IPFS_API_KEY=<your-lighthouse-api-key>

# Database (loaded from config.yaml)
DATABASE_URL=postgresql+asyncpg://user:pass@localhost/dbname
```

## Development Workflow

1. **Initial Setup:**
   ```bash
   # Run migrations (when database migration system is complete)
   alembic upgrade head

   # Seed sample data
   python scripts/seed_data.py
   ```

2. **Reset Database:**
   ```bash
   # Drop all tables
   alembic downgrade base

   # Recreate tables
   alembic upgrade head

   # Reseed data
   python scripts/seed_data.py
   ```

3. **Model Changes:**
   ```bash
   # After modifying models in src/models/
   alembic revision --autogenerate -m "description"

   # Review generated migration in alembic/versions/
   # Edit if necessary

   # Apply migration
   alembic upgrade head
   ```

## Future Scripts

Planned utility scripts:
- `backup_database.py` - Database backup utility
- `restore_database.py` - Database restore utility
- `calculate_user_levels.py` - Recalculate user levels based on points
- `cleanup_old_data.py` - Archive/remove old data
- `generate_test_data.py` - Generate large-scale test data for performance testing
